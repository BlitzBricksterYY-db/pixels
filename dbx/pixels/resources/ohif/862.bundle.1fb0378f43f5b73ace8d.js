"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[862],{49862:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n(41766),s=n(11374),a=n.n(s),i=n(14283),o=n(21683),c=n(80619),l=n(20767),u=n(4573),m=n(50719);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}const{formatDate:p}=i.utils;function E(e){const{displaySets:t,viewportId:n,viewportLabel:s,servicesManager:a,extensionManager:E}=e,{t:f}=(0,c.Bd)("Common"),{measurementService:S,cornerstoneViewportService:g,viewportGridService:v}=a.services,b=t[0],[I,w]=(0,u.B)(),[D,h]=(0,r.useState)(!1),[y,N]=(0,r.useState)(null),[V,T]=(0,r.useState)(null),{trackedSeries:k}=I.context,{SeriesDate:x,SeriesDescription:M,SeriesInstanceUID:U,SeriesNumber:R}=b,{PatientID:A,PatientName:C,PatientSex:_,PatientAge:P,SliceThickness:O,SpacingBetweenSlices:j,StudyDate:F,ManufacturerModelName:L}=b.images[0],W=(0,r.useCallback)((()=>{const e=g.getCornerstoneViewport(n);if(e instanceof m.BaseVolumeViewport){const t=e?.getCurrentImageId();if(!t)return void(D&&h(!1))}k.includes(U)!==D&&h(!D)}),[D,I,n,U]),B=(0,r.useCallback)((e=>{e.detail.element!==V&&(e.detail.element?.addEventListener(m.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,W),T(e.detail.element))}),[W,V]),q=(0,r.useCallback)((()=>{V?.removeEventListener(m.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,W)}),[W,V]);(0,r.useEffect)(W,[W]),(0,r.useEffect)((()=>{const{unsubscribe:e}=g.subscribe(g.EVENTS.VIEWPORT_DATA_CHANGED,(e=>{e.viewportId===n&&W()}));return()=>{e()}}),[W,n]),(0,r.useEffect)((()=>D?(l.annotation.config.style.setViewportToolStyles(n,{global:{lineDash:""}}),void g.getRenderingEngine().renderViewport(n)):(l.annotation.config.style.setViewportToolStyles(n,{global:{lineDash:"4,4"}}),g.getRenderingEngine().renderViewport(n),()=>{l.annotation.config.style.setViewportToolStyles(n,{})})),[D]),(0,r.useEffect)((()=>{const e=S.EVENTS.MEASUREMENT_ADDED,t=S.EVENTS.RAW_MEASUREMENT_ADDED,r=[];return[e,t].forEach((e=>{r.push(S.subscribe(e,(({source:e,measurement:t})=>{const{activeViewportId:r}=v.getState();if(n===r){const{referenceStudyUID:e,referenceSeriesUID:r}=t;w("SET_DIRTY",{SeriesInstanceUID:r}),w("TRACK_SERIES",{viewportId:n,StudyInstanceUID:e,SeriesInstanceUID:r})}})).unsubscribe)})),()=>{r.forEach((e=>{e()}))}}),[S,w,n,v]);return r.createElement(r.Fragment,null,r.createElement(o.cS,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},useAltStyling:D,onArrowsClick:e=>function(e){const t=function(e,t,n,r){const{measurementService:s,viewportGridService:a}=t.services,i=s.getMeasurements(),{activeViewportId:o,viewports:c}=a.getState(),{displaySetInstanceUIDs:l}=c.get(o),{trackedSeries:u}=r.context,m=i.filter((e=>u.includes(e.referenceSeriesUID)&&l.includes(e.displaySetInstanceUID)));if(!m.length)return;const d=m.length,p=m.map((e=>e.uid));let E=p.findIndex((e=>e===n));return-1===E?E=0:"left"===e?(E--,E<0&&(E=d-1)):"right"===e&&(E++,E===d&&(E=0)),p[E]}(e,a,y,I);t&&(N(t),S.jumpToMeasurement(n,t))}(e),getStatusComponent:()=>function(e){const{t}=(0,c.Bd)("TrackedCornerstoneViewport"),n=e?"status-tracked":"status-untracked";return r.createElement("div",{className:"relative"},r.createElement(o.m_,{position:"bottom-left",content:r.createElement("div",{className:"flex py-2"},r.createElement("div",{className:"flex pt-1"},r.createElement(o.In,{name:"info-link",className:"text-primary-main w-4"})),r.createElement("div",{className:"ml-4 flex"},r.createElement("span",{className:"text-common-light text-base"},e?r.createElement(r.Fragment,null,t("Series is tracked and can be viewed in the measurement panel")):r.createElement(r.Fragment,null,t("Measurements for untracked series will not be shown in the measurements panel")))))},r.createElement(o.In,{name:n,className:"text-aqua-pale"})))}(D),studyData:{label:s,studyDate:p(x)||p(F)||f("NoStudyDate"),currentSeries:R,seriesDescription:M,patientInformation:{patientName:C?i.Ay.utils.formatPN(C):"",patientSex:_||"",patientAge:P||"",MRN:A||"",thickness:O?`${parseFloat(O).toFixed(2)}`:"",thicknessUnits:f("mm"),spacing:void 0!==j?`${parseFloat(j).toFixed(2)}${f("mm")}`:"",scanner:L||""}}}),r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},(()=>{const{component:t}=E.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone");return r.createElement(t,d({},e,{onElementEnabled:B,onElementDisabled:q}))})()))}E.propTypes={displaySets:a().arrayOf(a().object.isRequired).isRequired,viewportId:a().string.isRequired,dataSource:a().object,children:a().node,customProps:a().object},E.defaultProps={customProps:{}};const f=E}}]);
//# sourceMappingURL=862.bundle.1fb0378f43f5b73ace8d.js.map