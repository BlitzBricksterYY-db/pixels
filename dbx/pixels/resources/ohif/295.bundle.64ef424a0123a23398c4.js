"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[295],{58295:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(11374),s=n.n(a),r=n(41766),i=n(80619),o=n(14283),l=n(21683);const c=function(e,t,n){const{tools:a}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,a)},u={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const p=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateSEGDisplaySet:s}){const{uiViewportDialogService:r}=e.services;return new Promise((async function(e,i){const o=await function(e,t){return new Promise((function(n,a){const s="Do you want to open this Segmentation?",r=[{type:l.Ny.NW.secondary,text:"No",value:u.CANCEL},{type:l.Ny.NW.primary,text:"Yes",value:u.HYDRATE_SEG}],i=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:s,actions:r,onSubmit:i,onOutsideClick:()=>{e.hide(),n(u.CANCEL)}})}))}(r,n);if(o===u.HYDRATE_SEG){a?.forEach((e=>{e()}));e(await s({segDisplaySet:t,viewportId:n}))}}))};function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}const{formatDate:m}=o.utils;function S(e){const{children:t,displaySets:n,viewportOptions:a,viewportLabel:s,servicesManager:u,extensionManager:S,commandsManager:y}=e,{t:E}=(0,i.Bd)("SEGViewport"),g=a.viewportId,{displaySetService:v,toolGroupService:f,segmentationService:w,uiNotificationService:D,customizationService:b}=u.services,I=`SEGToolGroup-${g}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const h=n[0],[N,T]=(0,l.ih)(),[C,k]=(0,r.useState)(1),[A,P]=(0,r.useState)(h.isHydrated),[G,x]=(0,r.useState)(!h.isLoaded),[M,O]=(0,r.useState)(null),[L,U]=(0,r.useState)({percentComplete:null,totalSegments:null}),V=(0,r.useRef)(null),{viewports:R,activeViewportId:_}=N,H=h.getReferenceDisplaySet(),j=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=a,r=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:i,SliceThickness:o}=r,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||o,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||i};return c}(H,h);V.current={displaySet:H,metadata:j};const F=e=>{O(e.detail.element)},B=()=>{O(null)},Y=(0,r.useCallback)((()=>{N?.viewports.forEach((({viewportId:e})=>{y.runCommand("storePresentation",{viewportId:e})}))}),[N]),q=(0,r.useCallback)((()=>{const{component:t}=S.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=V.current;return r.createElement(t,d({},e,{displaySets:[n,h],viewportOptions:{viewportType:"volume",toolGroupId:I,orientation:a.orientation,viewportId:a.viewportId},onElementEnabled:F,onElementDisabled:B}))}),[g,h,I]),W=(0,r.useCallback)((e=>{e="left"===e?-1:1;const t=h.displaySetInstanceUID,n=w.getSegmentation(t),{segments:a}=n,s=Object.keys(a).length;let r=C+e;r>s-1?r=1:0===r&&(r=s-1),w.jumpToSegmentCenter(t,r,I),k(r)}),[C]);(0,r.useEffect)((()=>{G||p({servicesManager:u,viewportId:g,segDisplaySet:h,preHydrateCallbacks:[Y],hydrateSEGDisplaySet:ae}).then((e=>{e&&P(!0)}))}),[u,g,h,G]),(0,r.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===h.displaySetInstanceUID&&x(!1)}));return()=>{e()}}),[h]),(0,r.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{U({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[h]),(0,r.useEffect)((()=>{const e=v.subscribe(v.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=R.get(_);e.includes(t.displaySetInstanceUID)&&T.setDisplaySetsForViewport({viewportId:_,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=f.getToolGroup(I);if(!e)return e=c(f,b,I),()=>{w.removeSegmentationRepresentationFromToolGroup(I),f.destroyToolGroup(I)}}),[]),(0,r.useEffect)((()=>(P(h.isHydrated),()=>{w.removeSegmentationRepresentationFromToolGroup(I),V.current=null})),[h]);let $=null;if(!V.current||H.displaySetInstanceUID!==V.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&($=t.map(((e,t)=>e&&r.cloneElement(e,{viewportId:g,key:t}))));const{PatientID:z,PatientName:J,PatientSex:K,PatientAge:Q,SliceThickness:X,ManufacturerModelName:Z,StudyDate:ee,SeriesDescription:te,SpacingBetweenSlices:ne}=V.current.metadata,ae=({segDisplaySet:e,viewportId:t})=>{y.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})},se=async()=>{Y();const e=await ae({segDisplaySet:h,viewportId:g});P(e)};return r.createElement(r.Fragment,null,r.createElement(l.cS,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:W,getStatusComponent:()=>function({isHydrated:e,onStatusClick:t}){let n=null,a=null;const{t:s}=(0,i.Bd)("Common"),o=s("LOAD");switch(e){case!0:a=()=>r.createElement(l.In,{name:"status-alert"}),n=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:a=()=>r.createElement(l.In,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>r.createElement("div",null,"Click LOAD to load segmentation.")}const c=()=>r.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},r.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},r.createElement(a,null),r.createElement("span",{className:"ml-1"},"SEG")),!e&&r.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},o));return r.createElement(r.Fragment,null,n&&r.createElement(l.m_,{content:r.createElement(n,null),position:"bottom-left"},r.createElement(c,null)),!n&&r.createElement(c,null))}({isHydrated:A,onStatusClick:se}),studyData:{label:s,useAltStyling:!0,studyDate:m(ee),seriesDescription:`SEG Viewport ${te}`,patientInformation:{patientName:J?o.Ay.utils.formatPN(J.Alphabetic):"",patientSex:K||"",patientAge:Q||"",MRN:z||"",thickness:X?o.utils.roundNumber(X,2):"",thicknessUnits:void 0!==X?"mm":"",spacing:void 0!==ne?o.utils.roundNumber(ne,2):"",scanner:Z||""}}}),r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},G&&r.createElement(l.pT,{className:"h-full w-full",totalNumbers:L.totalSegments,percentComplete:L.percentComplete,loadingText:"Loading SEG..."}),q(),$))}S.propTypes={displaySets:s().arrayOf(s().object),viewportId:s().string.isRequired,dataSource:s().object,children:s().node,customProps:s().object},S.defaultProps={customProps:{}};const y=S}}]);
//# sourceMappingURL=295.bundle.64ef424a0123a23398c4.js.map